<!--<?xml version="1.0" encoding="ISO-8859-1" ?>-->
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" charset="UTF-8" />
	<title>Liste des exemplaires : </title>
	<script src="my_ajax_util.js"></script>
	<script src="livreAjax.js"></script>
	<script LANGUAGE="JAVASCRIPT">exemplaireAdmin()</script>
</head>

<body>

	<h1>Liste des exemplaires :</h1>
	<div>
		<form>
			<div class="form-group">
			<label for="recherche"></label>
			<input type="text" id="recherche" class="form-control" placeholder="Rechercher par titre">
			<button type="submit" id="rechercher-btn" class="btn btn-primary">Chercher</button>
			</div>
		</form>
	</div>
	<br/>
	<div>
		<table border="1">
			<thead>
				<tr>
					<th>n° exemplaire</th>
					<th>Titre</th>
					<th>Etat</th>
					<th>Disponibilité</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody id="table_body" >
	
			</tbody>
		</table>
	</div>	
	
	<div>
		<p>
			<a href="livreAjaxAdmin.html"><button>Retour </button></a><br/>		
		</p>
	</div>
	
			<script >
	
	
		   
function RechercherExemplaire() {
	var titre = document.getElementById("recherche").value;
	
	if (titre){
	var xhr = new XMLHttpRequest();
	xhr.withCredentials = true;
	
	xhr.addEventListener("readystatechange", function() {
		console.log(this.responseText);
	  if(this.readyState === 4) {
		if ((xhr.status == 200 || xhr.status == 0)) {
			let data = JSON.parse(this.responseText)
			let bodyElt = document.getElementById("table_body");
			bodyElt.innerHTML = "";//vider le tableau avant de le re-remplir
			for (let exemp of data) {
				let row = bodyElt.insertRow(-1);
				(row.insertCell(0)).innerHTML = exemp.idExemp;
				(row.insertCell(1)).innerHTML = exemp.livre.titre;
				(row.insertCell(2)).innerHTML = exemp.etat;
				(row.insertCell(3)).innerHTML = exemp.isDisponibilite;

			// Créer un conteneur (div) pour les boutons "Modifier" et "Supprimer"
			let actionContainer = document.createElement("div");

			let linkModifier = document.createElement("a");
			linkModifier.href = "formulaireModifierExemplaire.html?id=" + exemp.idExemp + "&etat="+ exemp.etat + "&disponibilite=" + exemp.isDisponibilite  +  "&label=" + exemp.label  + "&idLivre="+ exemp.livre.idLivre ; 
			let modifierButton = document.createElement("button"); 
			modifierButton.textContent = "Modifier";
			linkModifier.appendChild(modifierButton);

			let linkSupprimer = document.createElement("a");
			let supprimerButton = document.createElement("button");
			supprimerButton.textContent = "Supprimer";
			supprimerButton.addEventListener("click", function() {
			Supprimerexemplaire(exemp.idExemp,exemp.etat,(exemp.isDisponibilite ? 'succes' : 'echec' ));
			});
			linkSupprimer.appendChild(supprimerButton);

			// Ajouter les liens "Modjeifier" et "Supprimer" au conteneur
			actionContainer.appendChild(linkModifier);
			actionContainer.appendChild(linkSupprimer);

			// Insérer le conteneur d'action dans la cellule "Action"
			let celluleAction = row.insertCell(4);
			celluleAction.appendChild(actionContainer);
		}
				
			}
		else {
			alert("Livre non existant ");
	}
				  
			}
	  });
	
	xhr.open("GET", "http://localhost:8080/AppBibliotheque/api-livres/livre/ListExempTitre/" + titre);
	xhr.send();
	}
	
	else{
		 alert("Veuillez remplir tous les champs!");
	}
}
	
   	
       // liaison du boutton ajouter à la fonction ajouterLivre()
        document.addEventListener("DOMContentLoaded", function() {
        var validerButton = document.getElementById("rechercher-btn");
        validerButton.addEventListener("click", function(event) {
            event.preventDefault(); 
            RechercherExemplaire(); 
        });
    });
    </script>
	
	
</body>

</html>